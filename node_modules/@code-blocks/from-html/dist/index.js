"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var ramda_1 = require("ramda");
var types_1 = require("@code-blocks/types");
var splitPre = function (html) {
    return ramda_1.flatten(html.split('<pre>').map(function (d, i) {
        if (i === 0) {
            return [{ isPre: false, content: d }];
        }
        var _a = d.split('</pre>'), before = _a[0], after = _a[1];
        return [
            { isPre: true, content: before },
            { isPre: false, content: after },
        ];
    }));
};
var hasLanguage = function (d) { return d.includes('class="language-'); };
var parsePreSplit = function (languages) {
    return function (_a) {
        var isPre = _a.isPre, content = _a.content;
        if (!isPre) {
            return {
                type: 'other',
                content: content,
            };
        }
        var _b = content.split('<code'), _ = _b[0], noCode = _b[1];
        var _c = noCode.split('>'), codeAttributes = _c[0], rest = _c.slice(1);
        var code = rest.join('>').split('</code>')[0];
        var language = hasLanguage(codeAttributes)
            ? codeAttributes.split('class="language-')[1].split('"')[0]
            : '';
        if (types_1.parseAllLanguages(languages) || languages.includes(language)) {
            return {
                type: 'code',
                language: language,
                content: code.trim(),
            };
        }
        return {
            type: 'other',
            content: "<pre>" + content + "</pre>",
        };
    };
};
exports.default = (function (html, languages) {
    return splitPre(html).map(parsePreSplit(languages));
});
